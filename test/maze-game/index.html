<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Maze</title>
    <link rel="stylesheet" href="maze.css">
  </head>
  <body>
    <header>
      <h1>Maze</h1>
      <div class="header-center">
        <span id="modeLabel" class="mode-label">Coding</span>
      </div>
      <div class="header-selectors">
        <button id="modeToggle" class="mode-toggle coding" aria-label="Toggle execution mode">
          <span id="modeAction" class="mode-action">Switch to Practice</span>
        </button>
        <div class="selector-group">
          <button id="pegmanButton"><img src="assets/pegman.png"><span>▼</span></button>
        </div>
        <div class="selector-group">
          <select id="languageSelect">
            <option value="en">English</option>
            <option value="fr">Français</option>
          </select>
        </div>
      </div>
    </header>

    <div id="instructionBar">
      <div class="instruction-content">
        <span id="levelInstruction"></span>
        <span id="contextualHint"></span>
      </div>
      <div class="shortcut-hints">
        <span><kbd>R</kbd> run</span>
        <span><kbd>[</kbd><kbd>]</kbd> levels</span>
        <span><kbd>F</kbd> fullscreen</span>
        <span><kbd>G</kbd> panel</span>
      </div>
    </div>

    <div class="container">
      <div class="blockly-container">
        <div id="blocklyDiv"></div>
        <button id="clearWorkspaceBtn" class="clear-workspace-btn">Delete all blocks</button>

        <!-- Immediate Mode Panel (for levels 1-2) -->
        <div id="immediateModePanel" class="immediate-mode-panel hidden">
          <div class="immediate-hint"><span id="immediateHint"></span><img id="immediateMarker" class="immediate-marker" alt="goal" /></div>
          <div class="command-buttons">
            <button id="cmdForward" class="command-btn" aria-label="Move Forward">
              <span class="cmd-label" data-msg="MAZE_PRACTICE_FORWARD">Move Forward</span>
              <img class="cmd-icon" src="assets/steps.svg" alt="" width="24" height="24">
            </button>
            <button id="cmdTurnLeft" class="command-btn" aria-label="Turn Left">
              <span class="cmd-label" data-msg="MAZE_PRACTICE_TURN_LEFT">Turn Left</span>
              <img class="cmd-icon" src="assets/turn_left.svg" alt="" width="24" height="24">
            </button>
            <button id="cmdTurnRight" class="command-btn" aria-label="Turn Right">
              <span class="cmd-label" data-msg="MAZE_PRACTICE_TURN_RIGHT">Turn Right</span>
              <img class="cmd-icon" src="assets/turn_right.svg" alt="" width="24" height="24">
            </button>
          </div>
          <div class="immediate-keyboard-hint">
            <span><kbd>↑</kbd> forward</span>
            <span><kbd>←</kbd> turn left</span>
            <span><kbd>→</kbd> turn right</span>
            <span><kbd>R</kbd> reset</span>
          </div>
        </div>
      </div>

      <button id="sidebarToggle" class="sidebar-toggle" aria-label="Toggle maze panel">
        <span class="toggle-icon">›</span>
      </button>

      <div class="game-container">
        <div class="level-selector">
          <button id="prevLevel">&lt; Back</button>
          <span id="levelDisplay">Level 1</span>
          <button id="nextLevel">Next &gt;</button>
        </div>

        <div class="canvas-wrapper">
          <canvas id="mazeCanvas"></canvas>
          <!-- Level Banner (positioned over maze) -->
          <div id="levelBanner" class="level-banner">
            <span class="level-number"></span>
          </div>
          <!-- Confetti Container (positioned over maze) -->
          <div id="confettiContainer"></div>
        </div>

        <div class="game-controls">
          <button id="runButton">Run Program</button>
          <button id="resetButton">Reset</button>
          <div id="capacityBubble" class="hidden"></div>
        </div>
      </div>
    </div>

    <div id="pegmanMenu"></div>
    <div id="hintDialog"><button class="close-btn">&times;</button><span id="hintText"></span></div>

    <!-- Result Modal (replaces alert boxes) -->
    <div id="resultModal" class="result-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="resultModalTitle" hidden>
      <div class="result-modal">
        <h2 id="resultModalTitle" class="result-modal-title"></h2>
        <p id="resultModalMessage" class="result-modal-message"></p>
        <div class="result-modal-buttons">
          <button id="resultModalCancel" class="result-modal-cancel" hidden>
            <span class="cancel-text">Cancel</span>
            <span class="cancel-hint">[Esc]</span>
          </button>
          <button id="resultModalOk" class="result-modal-ok">
            <span class="ok-text">OK</span>
            <span class="ok-hint">[Enter]</span>
            <span class="ok-progress"></span>
          </button>
        </div>
      </div>
    </div>

    <!-- Practice Mode Graduation Modal -->
    <div id="graduationModal" class="result-modal-overlay" role="dialog" aria-modal="true" aria-labelledby="graduationModalTitle" hidden>
      <div class="result-modal success">
        <h2 id="graduationModalTitle" class="result-modal-title"></h2>
        <p id="graduationModalMessage" class="result-modal-message"></p>
        <div class="result-modal-buttons graduation-buttons">
          <button id="graduationTryCoding" class="result-modal-ok graduation-primary"></button>
          <button id="graduationStay" class="result-modal-ok graduation-secondary"></button>
        </div>
      </div>
    </div>

    <!-- Christmas Snow Effect Container -->
    <div id="snowContainer"></div>

    <!-- Fullscreen Overlay -->
    <div id="fullscreenOverlay" aria-modal="true" role="dialog" aria-label="Fullscreen maze view">
      <button class="fullscreen-close" aria-label="Close fullscreen">&times;</button>
      <div class="fullscreen-maze-wrapper">
        <button class="fullscreen-level-nav fullscreen-prev" aria-label="Previous level">&lt; Back</button>
        <div class="fullscreen-canvas-container"></div>
        <button class="fullscreen-level-nav fullscreen-next" aria-label="Next level">Next &gt;</button>
      </div>
      <div class="fullscreen-controls">
        <button class="fullscreen-run">Run Program</button>
        <button class="fullscreen-reset">Reset</button>
      </div>
      <div class="fullscreen-hint">Press <kbd>Esc</kbd> or <kbd>F</kbd> to exit fullscreen</div>
    </div>

    <script src="bundle.js"></script>
  </body>
</html>
