# Internationalization (i18n) for Maze Game

This document explains how internationalization works in the maze game and how to add support for additional languages.

## Overview

The maze game uses Blockly's built-in i18n system with the `%{BKY_MESSAGE_KEY}` syntax. Messages are defined in TypeScript and loaded into `Blockly.Msg` before blocks are registered.

## Current Language Support

- **English (en)** - Default language
- **French (fr)** - Full translation from original blockly-games

## How It Works

### 1. Message Definition

Messages are defined in `messages.ts` in the `MESSAGES` object:

```typescript
const MESSAGES: Record<SupportedLocale, Record<string, string>> = {
  en: {
    MAZE_MOVE_FORWARD: 'move forward',
    MAZE_PATH_AHEAD: 'if path ahead',
    // ... more messages
  },
  fr: {
    MAZE_MOVE_FORWARD: 'avancer',
    MAZE_PATH_AHEAD: 'si chemin devant',
    // ... more messages
  },
};
```

### 2. Message Loading

Messages are loaded in `index.ts` before blocks are registered:

```typescript
const locale: SupportedLocale = getBrowserLocale();
loadMessages(locale);
registerMazeBlocks();
```

### 3. Block Definitions

Blocks use message keys with the `%{BKY_*}` syntax:

```typescript
{
  type: 'maze_if',
  message0: '%1%2%{BKY_MAZE_DO} %3',
  tooltip: '%{BKY_MAZE_IF_TOOLTIP}',
}
```

### 4. Blockly's Prefix/Suffix Extraction

Blockly automatically extracts common prefixes/suffixes from dropdown options. For example:

**Messages:**
- `MAZE_PATH_AHEAD: 'if path ahead'`
- `MAZE_PATH_LEFT: 'if path to the left'`
- `MAZE_PATH_RIGHT: 'if path to the right'`

**Rendered as:**
```
if path [ahead ▼]
        [to the left ▼]
        [to the right ▼]
```

The common prefix "if path" is extracted and displayed outside the dropdown, with only the unique parts shown in the dropdown menu.

## Adding a New Language

To add support for a new language (e.g., Spanish):

### Step 1: Update the SupportedLocale type

In `messages.ts`, add the new language code:

```typescript
export type SupportedLocale = 'en' | 'fr' | 'es';
```

### Step 2: Add translations

Add a new entry to the `MESSAGES` object:

```typescript
const MESSAGES: Record<SupportedLocale, Record<string, string>> = {
  en: { /* ... */ },
  fr: { /* ... */ },
  es: {
    // Block text
    MAZE_MOVE_FORWARD: 'avanzar',
    MAZE_TURN_LEFT: 'girar a la izquierda',
    MAZE_TURN_RIGHT: 'girar a la derecha',
    MAZE_PATH_AHEAD: 'si hay camino enfrente',
    MAZE_PATH_LEFT: 'si hay camino a la izquierda',
    MAZE_PATH_RIGHT: 'si hay camino a la derecha',
    MAZE_DO: 'hacer',
    MAZE_ELSE: 'sino',
    MAZE_REPEAT_UNTIL: 'repetir hasta',

    // Tooltips
    MAZE_MOVE_FORWARD_TOOLTIP: 'Mueve al jugador un cuadro hacia delante.',
    MAZE_TURN_TOOLTIP: 'Gira al jugador a izquierda o derecha 90 grados.',
    MAZE_IF_TOOLTIP: 'Si hay un camino en la dirección especificada, entonces ejecuta unas acciones.',
    MAZE_IFELSE_TOOLTIP: 'Si hay un camino en la dirección especificada, entonces ejecuta el primer bloque de acciones. Sino, haz el segundo bloque de acciones.',
    MAZE_WHILE_TOOLTIP: 'Repite las acciones contenidas hasta alcanzar el punto final.',

    // UI strings
    MAZE_RUN_PROGRAM: 'Ejecutar el programa',
    MAZE_RESET_PROGRAM: 'Restablecer',
    MAZE_CAPACITY: 'Te quedan %1 bloques.',
    MAZE_CONGRATULATIONS: '¡Felicitaciones!',
  },
};
```

### Step 3: Update getBrowserLocale()

Add detection for the new language:

```typescript
export function getBrowserLocale(): SupportedLocale {
  const browserLang = navigator.language || (navigator as any).userLanguage || 'en';
  const langCode = browserLang.toLowerCase().split('-')[0];

  if (langCode === 'fr') return 'fr';
  if (langCode === 'es') return 'es';

  return 'en'; // Default
}
```

### Step 4: Test

Change the locale in `index.ts` to test:

```typescript
const locale: SupportedLocale = 'es'; // Test Spanish
loadMessages(locale);
```

Or use `getBrowserLocale()` for automatic detection based on browser settings.

## Message Keys Reference

All message keys that need translation:

### Block Text
- `MAZE_MOVE_FORWARD` - "move forward" / "avancer"
- `MAZE_TURN_LEFT` - "turn left" / "tourner à gauche"
- `MAZE_TURN_RIGHT` - "turn right" / "tourner à droite"
- `MAZE_PATH_AHEAD` - "if path ahead" / "si chemin devant"
- `MAZE_PATH_LEFT` - "if path to the left" / "si chemin vers la gauche"
- `MAZE_PATH_RIGHT` - "if path to the right" / "si chemin vers la droite"
- `MAZE_DO` - "do" / "faire"
- `MAZE_ELSE` - "else" / "sinon"
- `MAZE_REPEAT_UNTIL` - "repeat until" / "répéter jusqu'à"

### Tooltips
- `MAZE_MOVE_FORWARD_TOOLTIP` - Explains the move forward block
- `MAZE_TURN_TOOLTIP` - Explains the turn block
- `MAZE_IF_TOOLTIP` - Explains the if block
- `MAZE_IFELSE_TOOLTIP` - Explains the if-else block
- `MAZE_WHILE_TOOLTIP` - Explains the repeat until block

### UI Strings (for future use)
- `MAZE_RUN_PROGRAM` - Button to run the program
- `MAZE_RESET_PROGRAM` - Button to reset
- `MAZE_CAPACITY` - Shows remaining blocks
- `MAZE_CONGRATULATIONS` - Success message

## Translation Sources

Translations are adapted from the original blockly-games project. You can find original translations at:

`blockly-games/server/html/maze/generated/msg/`

Each language has a `.js` file (e.g., `es.js`, `de.js`) containing all translated strings.

## Testing Different Languages

### Option 1: Language Selector (Recommended)
The game includes a language dropdown in the header. Simply:
1. Open the game in your browser
2. Click the language dropdown in the top-right corner
3. Select your preferred language (English or Français)
4. The page will reload with the new language

The selected language is saved in `localStorage`, so it persists across sessions.

### Option 2: Browser Detection (Default)
On first visit, the game automatically detects your browser language and displays accordingly. If your browser is set to French, the game will load in French automatically.

### Option 3: Manual Code Change
For development/testing, edit `index.ts` line 22-23:
```typescript
let currentLocale: SupportedLocale = 'fr'; // Force French
```

Then rebuild with `npm run build:maze`.

## Notes

- All translations must include the same message keys
- The `loadMessages()` function will fall back to English if a locale is not found
- Blockly's prefix/suffix extraction is automatic - just include the full text in translations
- For right-to-left languages (Arabic, Hebrew), additional Blockly RTL configuration may be needed
